<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
 <title>【设计模式】3. 装饰者模式 </title>



<meta name="description" content="Describe your website">


<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" id="ct-tracks-google-fonts-css" href="//fonts.googleapis.com/css?family=Raleway%3A400%2C700&amp;subset=latin%2Clatin-ext&amp;ver=4.7.2" type="text/css" media="all">
<link rel="stylesheet" href="https://HauyuChen.github.io/css/font-awesome.min.css" type='text/css' media='all'>

<link href="https://HauyuChen.github.io/css/style.css" rel="stylesheet" id="theme-stylesheet" type='text/css' media='all'>

<link href="https://HauyuChen.github.io/css/custom.css" rel="stylesheet" type='text/css' media='all'>
<link rel="shortcut icon" href="https://HauyuChen.github.io/img/favicon.ico" type="image/x-icon">
<link rel="icon" href="https://HauyuChen.github.io/img/favicon.ico" type="image/x-icon">




<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?dd096f3aba9332e2640cda59d3786695";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script></head>


<body class="post-template-default single single-post single-format-standard ct-body singular singular-post not-front standard">
  
  <div id="overflow-container" class="overflow-container">
    <a class="skip-content" href="#main">Skip to content</a>
    <header id="site-header" class="site-header" role="banner">
      <div class='top-navigation'>
        <div class='container'>

  <div id="menu-secondary" class="menu-container menu-secondary" role="navigation">
    <button id="toggle-secondary-navigation" class="toggle-secondary-navigation"><i class="fa fa-plus"></i></button>

    <div class="menu">

      <ul id="menu-secondary-items" class="menu-secondary-items">
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/elasticsearch">elasticsearch</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/java">java</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/zigbee">zigbee</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/%E5%9F%BA%E7%A1%80">基础</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">机器学习</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/%E7%AE%97%E6%B3%95">算法</a>
        </li>
        
        <li id="menu-item" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item">
          <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>
        </li>
        

      </ul>

    </div>

  </div>


  <ul class="social-media-icons">


    

    

    

    

    
    <li>
      <a href="mailto:Hauyu.Chen@gmail.com" data-animate-hover="pulse" class="email">
        <i class="fa fa-envelope" title="email"></i>
        <span class="screen-reader-text">email</span>
      </a>
    </li>
    

    

    


    
    <li>
      <a href="https://github.com/HauyuChen" data-animate-hover="pulse" class="github" target="_blank">
        <i class="fa fa-github" title="github"></i>
        <span class="screen-reader-text">github</span>
      </a>
    </li>
    

  </ul></div>

      </div>

      <div class="container">
        <div id="title-info" class="title-info">
  <div id='site-title' class='site-title'>
    
    <a href="/"> Hov&#39;s Blog </a>
    </div>
  </div>
  <button id="toggle-navigation" class="toggle-navigation">
    <i class="fa fa-bars"></i>
  </button>

  <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
  <div id="menu-primary" class="menu-container menu-primary" role="navigation">
    
    <p class="site-description">To code,  To record,  To recall.</p>
    

    <div class="menu">
      <ul id="menu-primary-items" class="menu-primary-items">
        <li id="menu-item" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item">
          <a href="/">主页</a>
        </li>

        
        
        
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item">
          <a href="/about-me/">关于我</a>
        </li>
        
        
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item">
          <a href="/about-site/">关于本站</a>
        </li>
        
        
      </ul>



    </div>

  </div>

      </div>
    </header>

    <div id="main" class="main" role="main">

      
  <div id="loop-container" class="loop-container">
    

      <div class="post type-post status-publish format-standard hentry category-standard category-travel entry full-without-featured odd excerpt-1">

        
        
        <div class='entry-header'>
		<br/><br/>
          <h1 class='entry-title'> 【设计模式】3. 装饰者模式</h1>
		  
        </div>
		<div class="entry-meta">
          
		<span class="date">日期：&nbsp;2017-09-29</span>	<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 作者： </span>

          <span class="author">
            
            Hov
            
          </span>
			<span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 归档： </span>
          
          <span class="category">
            
            <a href="/tags/%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f">设计模式&nbsp;&nbsp;</a>
          </span>
          


        </div>
		
        <div class="entry-container">
          <div class="entry-content">
            <article>
              

<hr />

<p><em>版权声明：本文由 Hov 所有，发布于 <a href="http://chenhy.com">http://chenhy.com</a> ，转载请注明出处。<br/></em></p>

<hr />

<p><br/></p>

<h1 id="1-装饰者模式">1 装饰者模式</h1>

<h2 id="1-1-简介">1.1 简介</h2>

<p>装饰者模式可动态地向对象添加额外的属性或行为。装饰者模式是类继承的另外一种选择，类继承在编译时候增加行为，而装饰模式是在运行时增加行为。在对象功能扩展方面，装饰者模式比继承更有弹性。</p>

<h2 id="1-2-思路">1.2 思路</h2>

<p>通过增加一个装饰类包裹原来的类，包裹的方式一般是通过将原来的对象作为装饰类的构造函数的参数，从而在原有对象上添加新的功能。</p>

<h2 id="1-3-使用场景">1.3 使用场景</h2>

<p>在不影响其它对象的情况下，想要动态地给单个对象添加新的属性或功能。</p>

<h2 id="1-4-优缺点">1.4 优缺点</h2>

<p>优点：</p>

<ol>
<li>可用一个或多个装饰者包装一个对象，扩展性强；</li>
<li>对象可以在任何时候被修饰，即动态修饰对象；</li>
<li>非继承，避免子类爆炸。</li>
</ol>

<p>缺点：</p>

<ol>
<li>出现额外的装饰类，使程序变得复杂。</li>
</ol>

<p><br/></p>

<h1 id="2-实例">2 实例</h1>

<p>模拟咖啡店：</p>

<p>假设，咖啡店有两种咖啡可选： Decaf 和 Espresso ，两种配料可选： Chocalate 和 Milk 。</p>

<p>不同的咖啡和配料可以搭配成不同的饮品，比如 Decaf 、 Espresso 、 Decaf + Chocalate 、 Decaf + Milk 、 Espresso + Chocalate 、 Espresso + Milk 六种不同的饮品。</p>

<p>我们要写个程序来计算不同饮品的价格，比如客户点了一杯 Espresso + Chocalate ，输出饮品的价格和描述信息。</p>

<h2 id="2-1-糟糕的解决方案">2.1 糟糕的解决方案</h2>

<p>设计超类 Drink ，继承自超类 Drink 的子类 Decaf 、 Espresso 、 Decaf + Chocalate 、 Decaf + Milk 、 Espresso + Chocalate 、 Espresso + Milk 。</p>

<p>显然，每种组合的饮品都要写成一个子类。这样将导致子类爆炸，设想种类多的时候将有几百上千个不同的饮品子类。</p>

<p>这样的方案虽然设计简单，只需写个超类，然后将所有不同的饮品通通继承自超类即可。但是缺点是显而易见的，几百个饮品将对应几百个子类，不合理。</p>

<p><br/></p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/ZSZMS-02.PNG" alt="" /></p>

<p><br/></p>

<h2 id="2-2-好一些的解决方案">2.2 好一些的解决方案</h2>

<ol>
<li>在超类 Drink 中定义 hasChocalate 、 setChocalate 、 hasMilk 、 setMilk 方法；</li>
<li>Decaf 、 Espresso 作为超类 Drink 的子类；</li>
<li>当需要 Decaf + Chocalate 就调用超类的 setChocalate 方法添加 Chocolate ，再通过 hasChocalate 方法计算总价。</li>
</ol>

<p>这种方法比上一种方法好一些，显然它不会引起类的爆炸。但是，因为配料相关的代码都是写在超类 Drink 里面的，如果我们要增加一种新的配料，就必须要修改超类 Drink ，这样维护性不好。</p>

<p><br/></p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/ZSZMS-01.PNG" alt="" /></p>

<p><br/></p>

<h2 id="2-3-基于装饰者模式的解决方案">2.3 基于装饰者模式的解决方案</h2>

<p>基于装饰者模式，咖啡作为主体（被装饰者），配料作为装饰者。通过装饰类包裹主体，从而实现主体的动态扩展。</p>

<p><strong>（1）超类 Drink</strong></p>

<p>创建超类 Drink ，其包含饮品的基本属性，如描述、价格、子类应该实现的方法。</p>

<pre><code>/* Drink.java */

public abstract class Drink {
    
    public String description = &quot;&quot;;     //描述
    private float price = 0f;           //价格
    
    public abstract float cost();
    
    public String getDescription() {
        return description+&quot;-&quot;+this.getPrice();
    }
    public void setDescription(String description) {
        this.description = description;
    }
    public float getPrice() {
        return price;
    }
    public void setPrice(float price) {
        this.price = price;
    }
    
}
</code></pre>

<p><strong>（2）被装饰者（ConcreteComponent）</strong></p>

<p>前面我们提到咖啡店有 Decaf 、 Espresso 两种咖啡，其实咖啡就是主体（被装饰者），我们可以往咖啡加入不同的配料“装饰”成不同的饮品。</p>

<p>Decaf 、 Espresso 继承自 Coffee ， Coffee 继承自 Drink 。也就是说，主体下有两种类型的咖啡，以后我们新增一种类型的咖啡 LongBlack ，就只需让 LongBlack 像 Decaf 那样继承自 Coffee 即可，而无需修改超类 Drink 。</p>

<pre><code>/* Coffee.java */

public class Coffee extends Drink {     //主体中间层

    @Override
    public float cost() {               //返回价格
        return super.getPrice();    
    }

}
</code></pre>

<pre><code>/* Decaf.java */

public class Decaf extends Coffee {     // Decaf 咖啡（被装饰者）
    
    public Decaf() {
        super.setDescription(&quot;Decaf&quot;);  //描述
        super.setPrice(3.0f);           //价格
    }
    
}
</code></pre>

<pre><code>/* Espresso.java */

public class Espresso extends Coffee {      // Espresso 咖啡（被装饰者）
    
    public Espresso() {
        super.setDescription(&quot;Espresso&quot;);   //描述
        super.setPrice(4.0f);               //价格
    }
    
}
</code></pre>

<p><strong>（3）装饰者（Decorator）</strong></p>

<p>咖啡可以加不同的配料，如牛奶、巧克力等等。牛奶、巧克力就是装饰者，通过它们包装被装饰者，从而使被装饰者实现动态扩展。</p>

<pre><code>/* Decorator.java */

public class Decorator extends Drink {      //中间层

    private Drink Obj;                      //被装饰的对象
    
    public Decorator(Drink Obj) {
        this.Obj = Obj;
    };
    
    @Override
    public float cost() {
        return super.getPrice()+Obj.cost();     //计算价格，要加上被装饰对象原有的价格
    }
    
    public String getDescription() {
        return super.description + &quot;-&quot; + super.getPrice() + &quot; &amp;&amp; &quot; +Obj.getDescription();   //递归增加原有属性
    }

}
</code></pre>

<pre><code>/* Chocolate.java */

public class Chocolate extends Decorator {  //巧克力（装饰者）
    
    public Chocolate(Drink Obj) {           
        super(Obj);
        super.setDescription(&quot;Chocolate&quot;);  //描述
        super.setPrice(3.0f);               //价格
    }
    
}
</code></pre>

<pre><code>/* Milk.java */

public class Milk extends Decorator {   //牛奶（装饰者）
    
    public Milk(Drink Obj) {
        super(Obj);
        super.setDescription(&quot;Milk&quot;);   //描述
        super.setPrice(2.0f);           //价格
    }
    
}
</code></pre>

<p>至此，我们已经完成了基础代码的编写。</p>

<p>我们设计了一个超类 Drink ，两个中间层 Coffee 、 Decorator ，两个继承自中间层 Coffee 的具体实现类 Decaf 、 Espresso ，两个继承自中间层 Decorator 的具体实现类 Chocolate 、 Milk 。</p>

<p>代码结构如下：</p>

<p><br/></p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/ZSZMS-03.jpg" alt="" /></p>

<p><br/></p>

<p><strong>（4）测试</strong></p>

<p>咖啡店新增了两个订单。</p>

<p>订单 1 ：客户单点了一杯 Decaf ；</p>

<p>订单 2 ：客户点了一杯 Espresso + Milk + Chocolate + Chocolate 。</p>

<p>最终，分别输出两个订单的饮品价格、饮品描述。</p>

<p>订单 2 结构如下：</p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/Espresso.png" alt="" /></p>

<pre><code>/* CoffeeBar.java */

public class CoffeeBar {

    public static void main(String[] args) {

        Drink order;    //订单

        //订单 1 ：只点Decaf，不加任何配料
        order = new Decaf();    //点一杯Decaf
        System.out.println(&quot;Order 1 Price:\n&quot;+order.cost());            //输出饮品价格
        System.out.println(&quot;Order 1 Desc:\n&quot;+order.getDescription());   //输出饮品描述
        
        System.out.println(&quot;******************&quot;);
        
        //订单 2 ：点一杯 Espress o，加一份 Milk 、两份 Chocolate
        order = new Espresso(); //点一杯Espresso
        order = new Milk(order);        // Milk 装饰 Espresso（加一份 Milk ）
        order = new Chocolate(order);   // Chocolate 装饰 Espresso + Milk（再加一份 Chocolate ）
        order = new Chocolate(order);   // Chocolate 装饰 Espresso + Milk + Chocolate（再加一份 Chocolate ）
        System.out.println(&quot;Order 2 Price:\n&quot;+order.cost());            //输出饮品价格
        System.out.println(&quot;Order 2 Desc:\n&quot;+order.getDescription());   //输出饮品描述
        
    }

}
</code></pre>

<p><strong>CoffeeBar.java 运行结果：</strong></p>

<pre><code>Order 1 Price:
3.0
Order 1 Desc:
Decaf-3.0
******************
Order 2 Price:
12.0
Order 2 Desc:
Chocolate-3.0 &amp;&amp; Chocolate-3.0 &amp;&amp; Milk-2.0 &amp;&amp; Espresso-4.0
</code></pre>

<p><br/></p>

<h1 id="3-结语">3 结语</h1>

<p>前面我们通过了一个实例来讲解装饰者模式。不同于直接使用继承，装饰者通过装饰类包裹被装饰对象实现扩展。</p>

<p>具体到例子中，两种咖啡（Decaf、Espresso），两种配料（Chocolate、Milk）。现在我们要实现 Decaf + Milk 的组合，常规的做法是 Decaf + Milk 直接继承自 Drink 这个超类，从而具备饮品的相关属性，但这样会引起子类爆炸。</p>

<p>通过装饰者模式，我们不直接使用继承。通过 Coffee 、 Decorator 作为中间层， Coffee 继承自超类 Drink ，显然 Coffee 具有基本的饮品属性（如 Decaf 、Espresso）。我们想要在 Decaf 上加入 Milk ，只需用 Decorator 中的 Milk 去包裹 Decaf 对象，从而 Decaf 对象增加了 Milk 相关的属性。</p>

<p>这就是装饰者模式实现动态扩展的思路。</p>

<p><br/></p>

            </article>
          </div>
          
      <div class='entry-meta-bottom'>
        





<div class="entry-tags"><p><span>文章分类：</span>
  
  <a href="/tags/elasticsearch" title="View all posts tagged elasticsearch">elasticsearch</a>
  
  <a href="/tags/java" title="View all posts tagged java">java</a>
  
  <a href="/tags/zigbee" title="View all posts tagged zigbee">zigbee</a>
  
  <a href="/tags/%E5%9F%BA%E7%A1%80" title="View all posts tagged 基础">基础</a>
  
  <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0" title="View all posts tagged 机器学习">机器学习</a>
  
  <a href="/tags/%E7%AE%97%E6%B3%95" title="View all posts tagged 算法">算法</a>
  
  <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" title="View all posts tagged 设计模式">设计模式</a>
  

</p></div>	</div>

<div class="author-meta">

  <div class="author">
    <img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/pic_logo.jpg" >

    <span>
      Written by:<a href="https://HauyuChen.github.io/" title="Posts by Hov" rel="author">Hov</a>        </span>
    </div>
    <div class="bio">
      
      <p>欢迎您访问本站，希望本站内容对您有所收获。<br/>如您有任何疑问，请与我联系：）</p>
      


      

    


  



<a class="email" target="_blank"
href="mailto:Hauyu.Chen@gmail.com">
<i class="fa fa-envelope"
title="email icon"></i>
</a>







<a class="github" target="_blank"
href="https://github.com/HauyuChen">
<i class="fa fa-github"
title="github icon"></i>
</a>


</div>
</div>

</div>
</div>

<section id="comments" class="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "http-hov-space" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  




</section>
</div>

 



    </div>

    <footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
    
    <a href=""> Hov&#39;s Blog </a>
    
	</h1>

			
			<p class="site-description">To code,  To record,  To recall.</p>
			

		<div id="menu-footer" class="menu-container menu-footer" role="navigation">
		<div class="menu">

      <ul id="menu-footer-items" class="menu-footer-items">
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/">Home</a></li>
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/about-me/">关于我</a></li>
        
        <li id="menu-item" class="menu-item menu-item-type-post_type menu-item-object-page menu-item"><a href="/about-site/">关于本站</a></li>
        
</ul>

</div>	</div>

<ul class="social-media-icons">

        

        


        

        

        
        <li>
        <a href="mailto:Hauyu.Chen@gmail.com"  class="email">
            <i class="fa fa-envelope" title="email"></i>
            <span class="screen-reader-text">email</span>
        </a>
        </li>
        

        

        


        
        <li>
        <a href="https://github.com/HauyuChen"  class="github" target="_blank">
            <i class="fa fa-github" title="github"></i>
            <span class="screen-reader-text">github</span>
        </a>
        </li>
        
				</ul>	<div class="design-credit">
		<p>
			Any questions?</p><p>Contacts <a href="/about-me/">Hov</a>.</p>
	</div>
</footer>

  </div>
  <script src="https://HauyuChen.github.io/js/jquery.min.js"></script>
<script src="https://HauyuChen.github.io/js/jquerymigrate.js"></script>
<script src="https://HauyuChen.github.io/js/production.min.js"></script>

</body>
</html>
