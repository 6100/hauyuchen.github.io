<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>谈谈向上转型、向下转型 &middot; Hov&#39;s Blog</title>

  <script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?dd096f3aba9332e2640cda59d3786695";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>	
  
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://HauyuChen.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://HauyuChen.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://HauyuChen.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://HauyuChen.github.io/img/favicon.ico" type="image/x-icon" />

  
  


</head>


<body>

<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  <a class="pure-menu-heading brand" href="https://HauyuChen.github.io/">
  <img src="https://HauyuChen.github.io/img/Hov.jpg" width="125px">
</a>

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/"><i class='fa fa-home fa-fw'></i>主页</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/post/"><i class='fa fa-list fa-fw'></i>所有文章</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/tags/"><i class='fa fa-folder fa-fw'></i>文章分类</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/topics/"><i class='fa fa-tags fa-fw'></i>关键词</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/booklist/"><i class='fa fa-list fa-fw'></i>技术书单</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/about-me/"><i class='fa fa-user fa-fw'></i>关于我</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/about-site/"><i class='fa fa-home fa-fw'></i>关于本站</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">

  <ul class="pure-menu-list">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/HauyuChen" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    
	</ul>
	<ul class="pure-menu-list">
	
	<li class="pure-menu-item">
      <a class="pure-menu-link" href="http://blog.csdn.net/u014134180" target="_blank"><i class="fa fa-lastfm-square fa-fw"></i>友链：Wu_Being</a>
    </li>
  </ul>
  
</div>


  <div>


</div>

</div>


  <div id="main">


<div class="header">
  <h1>谈谈向上转型、向下转型</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017-12-20</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://HauyuChen.github.io/tags/java">java</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://HauyuChen.github.io/tags/%E5%9F%BA%E7%A1%80">基础</a>
    
  </div>
  
  

  
  
  
  <div>
	<i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/java">Java</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/%E5%A4%9A%E6%80%81">多态</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/%E5%9F%BA%E7%A1%80">基础</a>
    
  </div>
  
  
  
</div>

  <p></p>

<hr />

<p><em>版权声明：本文由 Hov 所有，发布于 <a href="http://chenhy.com">http://chenhy.com</a> ，转载请注明出处。<br/></em></p>

<hr />

<p><em>更新说明：本文于 2017-10-01 修改部分内容。</em></p>

<hr />

<p><br/></p>

<h1 id="0-写在前面">0 写在前面</h1>

<hr />

<p>某天下午，群上抛出了一个关于 Java 向上转型的问题。</p>

<p><br/></p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/Discuss.jpg" alt="" /></p>

<p><br/></p>

<p>于是，我们以此为开端讨论了一个下午，从多态到类加载顺序。讨论结束后想着是不是要写篇文章记录下，所以有了这篇文章。</p>

<p>本文将谈及向上转型、向下转型的概念，后续有时间将扩充多态相关的更详细的知识。</p>

<p><br/></p>

<h1 id="1-向上转型">1 向上转型</h1>

<hr />

<h2 id="1-1-概念">1.1 概念</h2>

<p>向上转型是指子类对象转型为父类类型。通俗的说就是，对象变量是父类类型，但该对象变量引用的却是子类对象。</p>

<p>举个栗子，苹果是水果的一种，但我们有时会说苹果是水果或直接把苹果说成水果。其实，这样的说法就是向上转型，我们把苹果抽象为水果。伪代码表示如下：</p>

<pre><code>水果 对象变量名 = new 苹果();
</code></pre>

<p>Apple 是 Fruit 的子类。对象变量 apple 向上转型为 Fruit 类型，但 apple 仍引用的是 Apple 对象。</p>

<pre><code>Fruit apple = new Apple();  //向上转型
</code></pre>

<p>向上转型是对父类对象的方法的扩充，即父类对象可访问子类重写父类的方法。也许你会问，既然访问的还是子类对象的方法，为什么不直接声明为子类类型呢？</p>

<p>这就是 Java 抽象编程的奥秘。向上转型是实现多态的一种机制，我们可以通过多态性提供的动态分配机制执行相应的动作，使用多态编写的代码比使用对多种类型进行检测的代码更加易于扩展和维护。</p>

<p>其实我们会经常有意无意的使用转型。比如在我之前写到的关于装饰者模式<a href="http://chenhy.com/post/dp-3-%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/">装饰者模式</a>的文章就用到了向上转型的概念。
两种不同的咖啡 Decaf 、 Espresso 是 Coffee 的子类， Coffee 是 Drink 的子类。因为咖啡店可能会同时售卖不同的饮品，所以我们只需把不同的咖啡抽象为饮品即可，再通过引用不同的具体咖啡品种来表示不同的饮品。这样的场景其实大家都很熟悉，这就是向上转型的应用。也许你已经发现，向上转型可以跨层次。比如 Decaf 是 Coffee 的子类， Coffee 是 Drink 的子类，可以由 Decaf 直接向上转型为 Drink 。</p>

<h1 id="1-2-特性">1.2 特性</h1>

<p>向上转型的一个很重要的特性是，向上转型的对象会遗失子类中父类没有的方法，而且子类的同名方法会覆盖父类的同名方法。也就是说，由于向上转型，该对象对于只存在子类中而父类中不存在的方法是不能访问的。同时，若子类重写了父类的某些方法，在调用这些方法时，调用的是在子类定义的方法，这也就是动态链接、动态调用。</p>

<p>这似乎是合理的，苹果可以是水果，但不能说水果是苹果。如果要让水果调用苹果的特有的属性，显然是不符合常理的。</p>

<p>下面是向上转型的具体实现代码：</p>

<p><strong>（1）父类 Fruit</strong></p>

<pre><code>/* Fruit.java */

public class Fruit {        //水果

    public void name(){
        System.out.println(&quot;This is Fruit...&quot;);
    }

}
</code></pre>

<p><strong>（2）子类 Apple</strong></p>

<pre><code>/* Apple.java */            //苹果

public class Apple extends Fruit{

    public void name(){
        System.out.println(&quot;This is Apple...&quot;);
    }

    public void color(){    //注意父类没有该方法
        System.out.println(&quot;Red...&quot;);
    }

}
</code></pre>

<p><strong>（3）测试类</strong></p>

<pre><code>/* TestMain.java */

public class TestMain {

    public static void main(String[] args) {
        Fruit apple = new Apple();      //apple声明为Fruit类型，引用的是Apple对象
        apple.name();                   //父类子类共有的方法，输出：This is Apple...
        //apple.color();                //子类独有的方法，报错：无法编译，找不到color方法
    }

}

</code></pre>

<p>可见，由于向上转型，对象 apple 已经不能访问子类 Apple 中的 color 方法，因为父类 Fruit 不存在 color 方法。同时， apple 能访问 name 方法，因为父类 Fruit 和子类 Apple 都有 name 方法，但访问的会是子类中的 name 方法。</p>

<p><br/></p>

<h1 id="2-向下转型">2 向下转型</h1>

<hr />

<h2 id="2-1-概念">2.1 概念</h2>

<p>向下转型是指父类类型的对象转型为子类类型，也就是说，变量对象声明为子类类型，但其引用的是父类类型的对象。值得注意的是，不同于向上转型可以由编译器自动实现，向下转型需要强制转换。</p>

<h2 id="2-2-特性">2.2 特性</h2>

<p>向下转型可以分为两种情况。</p>

<h3 id="第一种-父类类型的对象引用的是子类对象">第一种：父类类型的对象引用的是子类对象</h3>

<p>这种情况下的向下转型是安全的，编译和运行都不会出错。</p>

<p><strong>举个栗子：</strong></p>

<p>对象 apple 首先向上转型为 Fruit 类型，但其引用的仍是子类 Apple 对象。此时，apple 是父类类型，引用的是子类对象。此时，如果将 apple 从 Fruit 向下转型为 Apple 是安全的，不会发生任何错误。</p>

<pre><code>/* TestMain.java */

public class TestMain {

    public static void main(String[] args) {
        Fruit apple = new Apple();      //apple是父类类型，引用的是子类对象
        apple.name();

        Apple fruit = (Apple)apple;     //强制转换：父类类型Fruit的对象apple向下转型为子类类型Apple
        fruit.name();
        fruit.color();                  //fruit可以访问color方法
    }

}
</code></pre>

<p><strong>运行结果：</strong></p>

<p>程序将不会报错，因为 apple 在向下转型时，原指向的就是子类对象。</p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/Discuss-02.PNG" alt="" /></p>

<h3 id="第二种-父类类型的对象引用的是父类对象">第二种：父类类型的对象引用的是父类对象</h3>

<p>这种情况下的向下转型是不安全的。虽然编译不会报错，但运行会出错。</p>

<p>看到这里你也许会发觉，向下转型其实只是子类引用对象（父类类型）转为子类引用对象（子类类型），也不能是父类引用对象（父类类型）转为子类引用对象（子类类型）。试想一下，如果将父类类型的对象（水果）转为子类类型的对象（苹果），那水果就可以访问苹果特有的方法了，也就是水果是苹果，这样显然是不成立的。因为我们知道继承链上，越靠上越抽象，越往下越具体。苹果是更具体的层次，自然有一些自身特有的，而水果没有的属性。</p>

<p><strong>举个栗子：</strong></p>

<p>fruit 对象声明为 Fruit 类型，其引用的也是 Fruit 对象，尝试将 fruit 对象向下转型成子类类型。</p>

<pre><code>/* TestMain.java */

public class TestMain {

    public static void main(String[] args) {
        Fruit fruit = new Fruit();      //fruit是父类类型，引用的是父类对象
        Apple apple = (Apple)fruit;     //强制转换：Fruit类型的fruit向下转型为Apple类型
        apple.name();
        apple.color();
    }

}
</code></pre>

<p><strong>运行结果：</strong></p>

<p>程序编译不会出错，但运行时会出错，并抛出 ClassCastException 异常。</p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/Discuss-03.PNG" alt="" /></p>

<p><br/></p>

<p><strong>注：关于类加载时，子类方法是否加载进内存的问题</strong></p>

<p>答案是肯定的。因为在加载类文件时，除了非静态成员变量（对象特有的属性）不会被加载外，其它的都会被加载。向上转型时，对象虽然遗失了与父类不同名的子类方法，但这些方法已经被加载进了内存，只不过向上转型的对象并不能调用这些子类方法。</p>

<p><br/></p>

<h1 id="3-总结">3 总结</h1>

<hr />

<ol>
<li>向上转型和向下转型是实现多态的一种机制；</li>
<li>向上转型可由编译器自动实现，目的是抽象化对象，简化编程；</li>
<li>向上转型时，子类将遗失与父类不同名的方法，子类同名方法将覆盖掉父类的方法；</li>
<li>向下转型需要强制转换；</li>
<li>向下转型要注意对象引用的是子类对象还是父类对象。前者不会报错，后者编译时不报错，运行时将出错，并抛出异常；</li>
<li>类加载时，除了对象特有的属性外，其它都将加载进内存。</li>
</ol>

<p><br/></p>

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://HauyuChen.github.io/post/zb-zigbee-parking/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://HauyuChen.github.io/post/zb-zigbee-parking/">【ZigBee系列】3.智能停车系统项目</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://HauyuChen.github.io/post/basic_full_text_search/">谈谈全文检索</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://HauyuChen.github.io/post/basic_full_text_search/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = "http-hov-space";
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://HauyuChen.github.io/js/ui.js"></script>




</body>
</html>

