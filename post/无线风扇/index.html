<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.24.1" />

  <title>无线风扇 &middot; Hov&#39;s Blog</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.2/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://HauyuChen.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://HauyuChen.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://HauyuChen.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://HauyuChen.github.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  <a class="pure-menu-heading brand" href="https://HauyuChen.github.io/">
  <img src="https://HauyuChen.github.io/img/Hov.jpg" width="125px">
</a>

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/"><i class='fa fa-home fa-fw'></i>主页</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/post/"><i class='fa fa-list fa-fw'></i>所有文章</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/tags/"><i class='fa fa-tags fa-fw'></i>分类</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/topics/"><i class='fa fa-folder fa-fw'></i>关键词</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href=""><i class='fa fa-user fa-fw'></i>关于我</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/contact/"><i class='fa fa-phone-square fa-fw'></i>联系我</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://HauyuChen.github.io/zhihu/"><i class='fa fa-phone-square fa-fw'></i>知乎</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/HauyuChen" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>


</div>

</div>


  <div id="main">


<div class="header">
  <h1>无线风扇</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2017-05-05</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/zigbee">ZigBee</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/%E7%89%A9%E8%81%94%E7%BD%91">物联网</a>&nbsp;&#47;
    
      <a class="post-taxonomy-topic" href="https://HauyuChen.github.io/topics/%E6%97%A0%E7%BA%BF%E4%BC%A0%E6%84%9F%E5%99%A8">无线传感器</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://HauyuChen.github.io/tags/zigbee">ZigBee</a>
    
  </div>
  
  

</div>

  

<blockquote>
<p>翻了下硬盘，无意中发现了在大二时写的这篇文章。无线风扇是本人在大二上学期在实验室期间实现的项目，实现了电风扇的无线控制。这也是我学习无线传感器网络实现的第一个项目，看着实验室的电风扇真的被代码操控着，感觉真的很奇妙。</p>

<p>本文记录了项目的大体思路，希望对你有所帮助。</p>

<p>转载请注明出处：Hov-<a href="http://hov.space">http://hov.space</a></p>
</blockquote>

<hr />

<h1 id="0-简介">0 简介</h1>

<p>无线风扇是本人接触 ZigBee 协议栈后完成的一个项目。实现风扇的手动和自动两种模式的控制。</p>

<ul>
<li>手动模式，ZigBee 协调器接收指令后控制风扇的开关；</li>
<li>自动模式，风扇根据周围环境的温度自动控制风扇，比如当周围温度大于等于 26 摄氏度时自动打开风扇。</li>
</ul>

<p>大体的思路是这样的： 通过两个 ZigBee 模块组成一个 ZigBee 网络；ZigBee终端外接温湿度传感器，外接继电器，继电器与风扇连接；ZigBee 协调器通过串口 RS232 与电脑连接（也可以通过 ZigBee 协调器与 GPRS 模块连接，实现手机控制的功能）。</p>

<p><img src="https://raw.githubusercontent.com/HauyuChen/PicsBox/master/fan01.PNG" alt="" /></p>

<p>虽说是无线风扇功能，实质就是实现传感器数据采集和 IO 口控制。风扇控
制主要通过 IO 口导通继电器来实现，所以，如果继电器连接电灯，空调等等，那就可以实现不同功能了。</p>

<hr />

<h1 id="1-功能阐述">1 功能阐述</h1>

<h2 id="1-1-串口通讯">1.1 串口通讯</h2>

<p>（1）ZigBee 网络采集的温湿度数据、风扇状态通过 RS232 串口传送给电脑，在串口调试助手上显示相关数据。</p>

<p>（2）电脑向 ZigBee 协调器发送指令，控制风扇的开关。</p>

<h2 id="1-2-温湿度数据采集">1.2 温湿度数据采集</h2>

<p>（1）ZigBee 终端外接 DHT11 温湿度传感器，通过传感器采集周围环境的温湿度信息；</p>

<p>（2）ZigBee 终端采集到的温湿度数据通过 ZigBee 网络发送给 ZigBee 协调器；</p>

<h2 id="1-3-风扇控制">1.3 风扇控制</h2>

<p>风扇控制分为两种模式：手动模式和自动模式</p>

<p>手动模式：ZigBee 协调器接收到电脑发送的指令后根据指令控制电风扇。
如，当收到“FAN_Y”，电风扇打开；当受到“FAN_N”，电风扇关闭。</p>

<p>自动模式：风扇状态根据周围环境的温度自动调节。当周围环境温度大
于等于 26 摄氏度时，电风扇自动打开；当周围环境小于 26 摄氏度时，电风扇自动关闭。</p>

<h2 id="1-4-状态反馈">1.4 状态反馈</h2>

<p>电风扇状态的实时显示。通过串口调试助手显示。</p>

<hr />

<h1 id="2-实现细节">2 实现细节</h1>

<h2 id="2-1-zigbee协议栈中实现串口通讯">2.1 ZigBee协议栈中实现串口通讯</h2>

<p>在第一篇中，简单提了一下串口的初始化，这里说一下如何在 ZigBee
协议栈中进行串口通讯。</p>

<p>（1）在SampleApp_Init函数里面添加串口初始化代码</p>

<pre><code>/* 串口配置结构体 */
halUARTCfg_t uartConfig;
/* 串口初始化 */
uartConfig.configured = TRUE;
uartConfig.baudRate = HAL_UART_BR_38400; //波特率设置为38400
uartConfig.flowControl = FALSE;
uartConfig.flowControlThreshold = 64;
uartConfig.rx.maxBufSize = 128;
uartConfig.tx.maxBufSize = 128;
uartConfig.idleTimeout = 6;
uartConfig.intEnable = TRUE;
uartConfig.callBackFunc = UART_CallBack;    //UART_CallBack 是自己写的串口回调函数
HalUARTOpen(0,&amp;uartConfig);         //启动串口
</code></pre>

<p>（2）编写串口回调函数</p>

<p>还记得在串口初始化中的uartConfig.callBackFunc = UART_CallBack;吗？</p>

<p>UART_CallBack 就是我们自己写的串口回调函数，在这个函数中可以定义当串口收到数据时我们要执行什么操作，至于怎么知道串口有没有收到数据我们就先不管了，由 ZigBee 协议栈自带的函数HalUARTRead 去解决，所以我们只需知道串口接收到了什么数据。</p>

<p>详细代码如下：</p>

<pre><code>//当串口接收到数据会自动调用串口回调函数 UART_CallBack
static void UART_CallBack (uint8 port,uint8 event)
{
    uint8 usartbuf[5] = &quot; &quot;;
    HalUARTRead(0,usartbuf,5); //从串口中读取数据，并存放在数组 usartbuf 中
    if(osal_memcmp(usartbuf,&quot;FAN_Y&quot;,5)) //如果读取的数据是 FAN_Y
    {
        //打开风扇
        SampleApp_OpenFan( ); //自己定义的，后面会提到
    }
    if(osal_memcmp(usartbuf,&quot;FAN_N&quot;,5)) //如果读取的数据是 FAN_N
    {
        //关闭风扇
        SampleApp_CloseFan( ); //自己定义的，后面会提到
    }
}
</code></pre>

<p>通过这样的一段代码我们就可以实现串口接收到特定数据执行特定功能的效果了，以后要应用的时候只需稍作修改，就可以实现其他的功能，可作模板使用。</p>

<p>（3）ZigBee协议栈中通过串口发送数据</p>

<p>前面我们提到了串口接受数据是通过自带函数 HalUARTRead 解决的，其实发送数据也是调用系统自带的函数，这些都是 ZigBee 协议栈里面封装好的，我们暂时只需知道它怎么用就好了。串口发送数据调用自带函数HalUARTWrite，比 如 通 过 串 口 发 送 数 据“Temperature:”，代码：</p>

<pre><code>HalUARTWrite(0,&quot;Temperature:&quot;,12);
</code></pre>

<h2 id="2-2-zigbee协议栈中实现传感器数据采集">2.2 ZigBee协议栈中实现传感器数据采集</h2>

<h3 id="2-2-1-传感器读取数据">2.2.1 传感器读取数据</h3>

<p>在本项目中，采用温湿度传感器 DHT11 采集周围环境的温湿度。
如何入手？拿到 DHT11 后，不用想着怎么在 ZigBee 协议栈里面用它，首先，在一个开发板上用它来采集数据，通过串口调试助手看看采集的数据是否正确。比如，下面的两个函数就是其采集数据的主要函数，这里只是讲述在 ZigBee 中的应用，至于如何采集传感器的数据，可以在开发板上试试通过 IO 口采集传感器的数据。</p>

<pre><code>void COM()      //温湿写入
{
    uchar i;
    for(i=0;i&lt;8;i++)
    {
        ucharFLAG=2;
        while((!wenshi)&amp;&amp;ucharFLAG++);
        Delay_10us();
        Delay_10us();
        Delay_10us();
        uchartemp=0;
        if(wenshi){
            uchartemp=1;    
        }
        ucharFLAG=2;
        while((wenshi)&amp;&amp;ucharFLAG++);
        if(ucharFLAG==1){
            break;
        }
        ucharcomdata&lt;&lt;=1;
        ucharcomdata|=uchartemp;
    }
}

void DHT11_TEST()   //温湿传感启动
{
    wenshi=0;
    Delay_ms(19);   //&gt;18MS
    wenshi=1;
    P1DIR &amp;= ~0x01; //重新配置 IO 口方向
    Delay_10us();
    Delay_10us();
    Delay_10us();
    Delay_10us();
    if(!wenshi)
    {
        ucharFLAG=2;
        while((!wenshi)&amp;&amp;ucharFLAG++);
        ucharFLAG=2;
        while((wenshi)&amp;&amp;ucharFLAG++);
        COM();
        ucharRH_data_H_temp=ucharcomdata;
        COM();
        ucharRH_data_L_temp=ucharcomdata;
        COM();
        ucharT_data_H_temp=ucharcomdata;
        COM();
        ucharT_data_L_temp=ucharcomdata;
        COM();
        ucharcheckdata_temp=ucharcomdata;
        wenshi=1;
        uchartemp=(ucharT_data_H_temp+ucharT_data_L_temp+ucharRH_data_
        H_temp+ucharRH_data_L_temp);
        if(uchartemp==ucharcheckdata_temp)
        {
            ucharRH_data_H=ucharRH_data_H_temp;
            ucharRH_data_L=ucharRH_data_L_temp;
            ucharT_data_H=ucharT_data_H_temp;
            ucharT_data_L=ucharT_data_L_temp;
            ucharcheckdata=ucharcheckdata_temp;
        }
        wendu_shi=ucharT_data_H/10;
        wendu_ge=ucharT_data_H%10;
        shidu_shi=ucharRH_data_H/10;
        shidu_ge=ucharRH_data_H%10;
    }
    else //没成功读取，返回 0
    {
        wendu_shi=0;
        wendu_ge=0;
        shidu_shi=0;
        shidu_ge=0;
    }
    P1DIR |= 0x01; //IO 口需要重新配置
}
</code></pre>

<h3 id="2-2-2-在zigbee工程添加传感器代码">2.2.2 在ZigBee工程添加传感器代码</h3>

<p>在 2.2.1 中已经介绍了传感器的数据采集，可是我们怎么把它用在ZigBee 协议栈中呢？
很简单，我们知道ZigBee工程中所有的功能都是围绕SampleApp_ProcessEvent 函数实现的，所以我们应该在这个函数内部作
相应的修改。再次简单地介绍下这个函数，它的大体结构是这样的：</p>

<pre><code>uint16 SampleApp_ProcessEvent( uint8 task_id, uint16 events )
{
    if ( events &amp; SYS_EVENT_MSG )  //系统事件
    {
        while ( MSGpkt )
        {
            switch ( MSGpkt-&gt;hdr.event )
            {
                case KEY_CHANGE: //发送按键改变
                break;
                case AF_INCOMING_MSG_CMD:  //接收到空中消息
                break;
                case ZDO_STATE_CHANGE: //设备状态改变
                break;
                default:
                break;
            }
        }
        return (events ^ SYS_EVENT_MSG);
    }
    if ( events &amp; SAMPLEAPP_SEND_PERIODIC_MSG_EVT ) //用户事件
    {
        //温湿度检测
        DHT11_TEST(); //这个函数就是传感器的入口了！！调用它获取传感器采集到的数据，当然我们这个函数是我们自己写的
        //点对点通讯的程序
        SampleApp_SendPointToPointMessage(); //把 ZigBee 终端采集到的数据发送给 ZigBee 协调器
        //定时触发用户事件，也就是这个函数每个规定的时间就执行一次，所以本项目每隔一段时间采集周围环境的温湿度数据
        osal_start_timerEx(SampleApp_TaskID,SAMPLEAPP_SEND_PERIODIC_MSG_EVT,
        (SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT + (osal_rand() &amp;
        0x00FF)) );
        // return unprocessed events
        return (events ^ SAMPLEAPP_SEND_PERIODIC_MSG_EVT);
    }
    return 0;
}
</code></pre>

<h3 id="2-2-3-dht11-c的编写">2.2.3 DHT11.C的编写</h3>

<p>在 2.2.2 中我们提到调用 DHT11_TEST(); 函数就能知道传感器采集到的数据。可是，为什么呢？其实这个函数时需要我们自己写的，为了代码简洁，我们新建一个.c 文件，在里面放温湿度传感器 DHT11 采集数据的代码。
2.2.1 已经给出了 DHT11.c 内比较重要的两个函数，具体实现代码看”ZigBee 组网（继电器）”文件夹，里面有无线风扇项目的完整源代码，可以看看 DHT11.c 是怎么写的。
DHT11.c 内部实现了传感器的数据采集，最后通过 DHT11_TEST 封装起来，所以在主文件中调用 DHT11_TEST 函数就能获取到传感器的数据了。</p>

<h3 id="2-2-4-zigbee终端发送温湿度数据">2.2.4 ZigBee终端发送温湿度数据</h3>

<p>前面我们已经获取了传感器采集到的数据，这些数据存放在了几个变量（wendu_shi、wendu_ge、shidu_shi、shidu_ge）中。所以在发送数据函数中将这些数据发送给 ZigBee 协调器就可以了。</p>

<pre><code>void SampleApp_SendPointToPointMessage( void )
{
    uint8 T_H[5]; //温度+湿度+状态
    /* 温度 */
    T_H[0]=wendu_shi+48; //整型转换成字符串
    T_H[1]=wendu_ge%10+48; //整型转换成字符串
    /* 湿度 */
    T_H[2]=shidu_shi+48; //整型转换成字符串
    T_H[3]=shidu_ge%10+48; //整型转换成字符串
    /* 风扇状态 */
    T_H[4]=flag+48; //整型转换成字符串
    if ( AF_DataRequest( &amp;Point_To_Point_DstAddr,
            &amp;SampleApp_epDesc,
            SAMPLEAPP_SEND_DATA_PTOP_CLUSTERID, //簇 ID
            5,              //数据长度
            T_H,            //数据存放位置
            &amp;SampleApp_TransID,
            AF_DISCV_ROUTE,
            AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    {
    }
    else
    {
        // Error occurred in request to send.
    }
}
</code></pre>

<h3 id="2-2-5-zigbee协调器接收温湿度数据">2.2.5 ZigBee协调器接收温湿度数据</h3>

<p>ZigBee 协调器接收到数据后将数据通过串口发送到电脑，所以在电脑通过串口调试助手就可以知道传感器采集到了什么数据了。</p>

<pre><code>case SAMPLEAPP_SEND_DATA_PTOP_CLUSTERID: //和 2.2.4 发送出去的簇 ID 一致
    /* 温度串口输出 */
    HalUARTWrite(0,&quot;Temperature:&quot;,12); //提示接收到数据
    HalUARTWrite(0,&amp;pkt-&gt;cmd.Data[0],2); //温度
    HalUARTWrite(0,&quot; &quot;,1); //空格
    /* 湿度串口输出 */
    HalUARTWrite(0,&quot;Humidity:&quot;,9); //提示接收到数据
    HalUARTWrite(0,&amp;pkt-&gt;cmd.Data[2],2); //湿度
    HalUARTWrite(0,&quot; &quot;,1); //空格
    /* 风扇状态打印 */
    HalUARTWrite(0,&quot;State:&quot;,6); //提示接收到数据
    HalUARTWrite(0,&amp;pkt-&gt;cmd.Data[4],1); //风扇状态
    HalUARTWrite(0,&quot;\n&quot;,1); //回车换行
</code></pre>

<h2 id="2-3-zigbee协议栈中如何实现风扇控制">2.3 ZigBee协议栈中如何实现风扇控制</h2>

<p>实现风扇控制，实际上就是实现继电器的控制，风扇的地线和火线分别接到继电器的两个口，通过继电器决定是否导通。然后将继电器连接在 ZigBee 终端的 IO 口，通过控制这个 IO 的状态，就可以使继电器导通或者不导通了。如：</p>

<pre><code>/* 风扇继电器引脚的定义 */
#define FAN P1_3
</code></pre>

<p>使用 P1.3IO 口，那么将继电器的控制线接到 P1.3 引脚就可以了。也就是说，P1_3 口的状态决定风扇的状态。</p>

<h3 id="2-3-1-手动模式">2.3.1 手动模式</h3>

<p>（1）串口接收控制指令
当串口接收到数据时，判断数据是否是控制指令，若是，执行相应的功能。</p>

<pre><code>static void UART_CallBack (uint8 port,uint8 event)
{
    uint8 usartbuf[5] = &quot; &quot;;
    HalUARTRead(0,usartbuf,5); //从串口中读取数据，并存放在 buf 中
    if(osal_memcmp(usartbuf,&quot;FAN_Y&quot;,5)) //如果读取的数据是FAN_Y
    {
        SampleApp_OpenFan( );   //打开风扇
    }
    if(osal_memcmp(usartbuf,&quot;FAN_N&quot;,5)) //如果读取的数据是FAN_N
    {
        SampleApp_CloseFan( );  //关闭风扇
    }
}
</code></pre>

<p>（2）打开风扇函数 SampleApp_OpenFan</p>

<p>其 实 很 简 单 ， 打 开 风 扇 ， 其 实 就 是 发 送 簇 ID 为
SAMPLEAPP_FAN_ON_CLUSTERID 的数据。</p>

<pre><code>void SampleApp_OpenFan(void)
{
    HalLedBlink(HAL_LED_2,3,50,100);
    uint8 data[1];
    data[0] = 1;        //任意数据均可
    if(AF_DataReques(&amp;SampleApp_Flash_DstAddr,&amp;SampleApp_epDesc,
            SAMPLEAPP_FAN_ON_CLUSTERID,
            1,
            data,
            &amp;SampleApp_TransID,
            AF_DISCV_ROUTE,
            AF_DEFAULT_RADIUS  )  ==afStatus_SUCCESS )
    {
    }
    else
    {
        // Error occurred in request to send.
    }
}
</code></pre>

<p>（3）关闭风扇函数 SampleApp_CloseFan</p>

<p>同样 ，关闭风扇就是发送簇ID为SAMPLEAPP_FAN_OFF_CLUSTERID的数据。</p>

<pre><code>void SampleApp_CloseFan(void)
{
    HalLedBlink(HAL_LED_2,3,50,100);
    uint8 data[1];
    data[1] = 0;        //任意数据均可
    if(AF_DataRequest(&amp;SampleApp_Flash_DstAddr,&amp;SampleApp_epDesc,
            SAMPLEAPP_FAN_OFF_CLUSTERID,
            1,
            data,
            &amp;SampleApp_TransID,
            AF_DISCV_ROUTE,
            AF_DEFAULT_RADIUS  )  ==afStatus_SUCCESS )
    {
    }
    else
    {
        // Error occurred in request to send.
    }
}
</code></pre>

<p>（4）接收端控制 IO 口状态</p>

<p>当接收到接收到数据时，在 case AF_INCOMING_MSG_CMD 中调用消息处理函数。</p>

<pre><code>case AF_INCOMING_MSG_CMD:
    SampleApp_MessageMSGCB( MSGpkt );
break;
</code></pre>

<p>然后在消息处理函数 SampleApp_MessageMSGCB 中判断接收的是什么数据</p>

<pre><code>case SAMPLEAPP_FAN_ON_CLUSTERID:  //打开风扇
    FAN = 0;        //继电器低电平有效，为 0 时导通，风扇打开
    HalLedSet( HAL_LED_2, HAL_LED_MODE_ON ); //指示灯亮
    flag = 1;
break;
case SAMPLEAPP_FAN_OFF_CLUSTERID:  //关闭风扇
    FAN = 1;        //继电器低电平有效，为 1 时不导通，风扇关闭
    HalLedSet( HAL_LED_2, HAL_LED_MODE_OFF ); //指示灯灭
    flag = 0;
break;
</code></pre>

<h3 id="2-3-2-自动模式">2.3.2 自动模式</h3>

<p>前面提到 ZigBee 终端采集到传感器的数据后，会将这些数据通过ZigBee 网络发送给 ZigBee 协调器。自动模式要实现温度大于设定值后自动打开，也就是说，要判断接收到的数据是多少，然后根据数据来决定风扇是否打开。</p>

<pre><code>case SAMPLEAPP_SEND_DATA_PTOP_CLUSTERID: //收到传感器数据
    int t = (pkt-&gt;cmd.Data[0]-48)*10 + (pkt-&gt;cmd.Data[1]-48);   //数据转换
    int flag;
    if(t&gt;=26) //温度大于等于 26
    {
        SampleApp_OpenFan();  //打开风扇
        flag = 1;
    }
    else if(t&lt;26) //温度小于 26
    {
        SampleApp_CloseFan();  //关闭风扇
        flag = 0;
    }
break;
</code></pre>

<hr />

<h1 id="3-总结">3 总结</h1>

<p>无线风扇这个项目其实不难，只需有 ZigBee 组网、IO 口控制和传感器数据采集的知识就可以完成这样的功能。刚学习 ZigBee 后可以试试实现这样的小功能，容易找到学习的乐趣。本文讲了整个小项目的大体思路和部分实现细节，具体的实现方式可以看附录的源代码。</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://HauyuChen.github.io/post/292-nim-game/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://HauyuChen.github.io/post/292-nim-game/">292. Nim Game</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://HauyuChen.github.io/post/485-max-consecutive-ones/">485. Max Consecutive Ones</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://HauyuChen.github.io/post/485-max-consecutive-ones/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'hov.space';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://HauyuChen.github.io/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72514969-1', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

